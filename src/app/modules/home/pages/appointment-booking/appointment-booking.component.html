<ion-content scroll-y="false">
  <div class="appointment-header">
    <p class="header-title">Tu Agenda</p>
    <img
      [src]="profileImage"
      [alt]="'Foto de ' + (user?.first_name || 'usuario')"
      class="profile-image"
    />
  </div>

  <div class="content-container">
    <!-- Spinner de carga mientras se cargan las citas -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="circular"></ion-spinner>
      <p>Cargando tus citas...</p>
    </div>

    <!-- Mensaje cuando no hay citas -->
    <div *ngIf="!isLoading && appointments.length === 0" class="empty-message">
      No tienes citas agendadas. 
      <p>Puedes seleccionar un profesional abajo para solicitar una cita.</p>
    </div>

    <!-- Lista de citas -->
    <div *ngIf="!isLoading && appointments.length > 0" class="appointments-list">
      <div class="appointments-container">
        <h3 class="section-title">Tus próximas citas</h3>
        <div *ngFor="let appointment of appointments; trackBy: trackByAppointmentId">
          <app-appointment-card
            [appointmentId]="appointment.id"
            [first_name]="appointment.professionalData?.user?.first_name"
            [last_name]="appointment.professionalData?.user?.last_name"
            [specialty]="appointment.specialty_name || appointment.specialty"
            [date]="appointment.appointment_date_formatted"
            [time]="appointment.appointment_time_formatted"
            [dayOfWeek]="appointment.day"
            (appointmentCanceled)="onAppointmentCanceled($event)"
          ></app-appointment-card>
        </div>
      </div>
    </div>

    <!-- Sección de profesionales -->
    <div class="profesional-scroll">
      <h3 class="section-title">Profesionales disponibles</h3>
      <div class="professional-cards-container" (scroll)="onScroll($event)">
        <app-health-professional-card
          *ngFor="let prof of professionals"
          [professionalId]="prof.id"
          [buttonVisible]="true"
          [first_name]="prof.user.first_name"
          [last_name]="prof.user.last_name"
          [specialty_name]="prof.specialty_name"
          [gender]="prof.user!.gender || 'M'"
          [profileImage]="prof.image.header_path"
          [scheduleInfo]="prof.scheduleInfo || {type: 'ONLINE', description: '', isBooking: true}"
          [agendaColor]="'var(--ion-color-secondary)'"
        ></app-health-professional-card>
      </div>

      <!-- Indicadores de scroll horizontal -->
      <div class="professional-indicators" *ngIf="professionals.length > 1">
        <span
          class="indicator"
          *ngFor="let professional of professionals; let i = index"
          [ngClass]="{ active: i === currentProfessionalIndex }"
        ></span>
      </div>
    </div>
  </div>
</ion-content>

<app-tab-bar
  [isVisible]="true"
  [buttons]="[
    { icon: 'arrow-back-outline', route: '/home/dashboard', visible: true },
    { icon: 'menu-outline', route: '/', visible: true },
    { icon: 'exit-outline', route: '/', visible: true }
  ]"
  [background]="backgroundStyle"
></app-tab-bar>